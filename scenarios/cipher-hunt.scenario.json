{
    "$schema": "./schema.json",
    "id": "cipher-hunt",
    "name": "The Cipher Hunt",
    "description": "A mysterious message has been left on the system. Can you decode the clues and uncover the secret? Search through files, use the calculator, and piece together the puzzle!",
    "version": "1.0.0",
    "author": "IlluminatOS Team",
    "icon": "üîê",
    "difficulty": "medium",
    "estimatedTime": "15-20 minutes",
    "tags": ["puzzle", "mystery", "codes"],

    "requirements": {
        "apps": ["notepad", "calculator", "terminal"],
        "features": []
    },

    "config": {
        "allowSkip": false,
        "showProgress": true,
        "autoSave": true,
        "hintDelay": 45000,
        "maxHints": 3
    },

    "variables": {
        "cluesFound": 0,
        "totalClues": 3,
        "clue1Decoded": false,
        "clue2Decoded": false,
        "clue3Decoded": false,
        "secretRevealed": false
    },

    "onStart": {
        "actions": [
            {
                "type": "createFile",
                "path": ["Desktop", "MYSTERY.txt"],
                "content": "=== CLASSIFIED DOCUMENT ===\n\nAgent,\n\nA hidden message awaits discovery on this system.\nThree clues are scattered across the desktop.\nEach clue, when decoded, reveals a number.\n\nThe final code is the sum of all three numbers.\n\nGood luck.\n\n- X\n\nHINT: Start by looking at the files on your Desktop...",
                "addToDesktop": true,
                "icon": "üìú"
            },
            {
                "type": "createFile",
                "path": ["Desktop", "clue_1.txt"],
                "content": "CLUE #1 - THE ALPHABET CIPHER\n\nThe first number is hidden in this message:\n\n\"Wkuhh lv wkh iluvw qxpehu.\"\n\nHint: Caesar would know... shift by 3.",
                "addToDesktop": true,
                "icon": "üìù"
            },
            {
                "type": "createFile",
                "path": ["Desktop", "clue_2.txt"],
                "content": "CLUE #2 - BINARY SECRETS\n\nThe second number is encoded in binary:\n\n01000010 01001001 01001110 01000001 01010010 01011001\n\nWait, that's just the word 'BINARY'...\n\nThe REAL number is: 101010\n\nDecode this binary to decimal!",
                "addToDesktop": true,
                "icon": "üìù"
            },
            {
                "type": "createFile",
                "path": ["Desktop", "clue_3.txt"],
                "content": "CLUE #3 - MATH PUZZLE\n\nThe third number requires calculation:\n\n(7 x 8) - (5 x 3) + 2 = ?\n\nUse the Calculator to find the answer!",
                "addToDesktop": true,
                "icon": "üìù"
            },
            {
                "type": "showDialog",
                "title": "The Cipher Hunt",
                "message": "A mystery awaits! Someone has left encrypted messages on this computer. Explore the files on your Desktop to find the clues.\n\nYour goal: Decode all three clues and find the secret code!",
                "icon": "info",
                "buttons": ["Begin Investigation"]
            },
            {
                "type": "playSound",
                "sound": "startup"
            }
        ]
    },

    "stages": [
        {
            "id": "start",
            "name": "Investigation Begins",
            "description": "Explore the desktop and find the mystery file",
            "isInitialStage": true,
            "onEnter": {
                "actions": [
                    {
                        "type": "showNotification",
                        "message": "Look for the MYSTERY.txt file on your Desktop!",
                        "duration": 4000
                    }
                ]
            },
            "hints": [
                { "delay": 30000, "message": "Double-click on MYSTERY.txt to read the instructions." }
            ],
            "triggers": [
                {
                    "id": "mystery-opened",
                    "event": "notepad:opened",
                    "conditions": {
                        "type": "or",
                        "conditions": [
                            { "type": "eventMatch", "field": "path", "op": "contains", "value": "MYSTERY" },
                            { "type": "eventMatch", "field": "content", "op": "contains", "value": "CLASSIFIED" }
                        ]
                    },
                    "actions": [
                        {
                            "type": "showClippy",
                            "message": "Interesting! There are three clues to find. Start with clue_1.txt!",
                            "duration": 5000
                        },
                        { "type": "advanceStage", "stageId": "clue1" }
                    ]
                }
            ]
        },
        {
            "id": "clue1",
            "name": "Clue #1 - Caesar Cipher",
            "description": "Decode the alphabet cipher",
            "onEnter": {
                "actions": [
                    {
                        "type": "showNotification",
                        "message": "Find and decode Clue #1!",
                        "duration": 3000
                    }
                ]
            },
            "hints": [
                { "delay": 45000, "message": "Caesar cipher shifts letters. 'A' becomes 'D' (shift 3)." },
                { "delay": 90000, "message": "Decode 'Fwrnw' - shift each letter back by 3. F->C, W->T..." }
            ],
            "triggers": [
                {
                    "id": "clue1-solved",
                    "event": "notepad:typed",
                    "conditions": {
                        "type": "or",
                        "conditions": [
                            { "type": "eventMatch", "field": "content", "op": "contains", "value": "THREE" },
                            { "type": "eventMatch", "field": "content", "op": "contains", "value": "three" },
                            { "type": "eventMatch", "field": "content", "op": "contains", "value": "3" }
                        ]
                    },
                    "actions": [
                        { "type": "setState", "path": "clue1Decoded", "value": true },
                        { "type": "modifyState", "path": "cluesFound", "operation": "increment" },
                        {
                            "type": "showNotification",
                            "message": "Clue #1 decoded! The first number is 3!",
                            "duration": 4000
                        },
                        { "type": "playSound", "sound": "click" },
                        { "type": "advanceStage", "stageId": "clue2" }
                    ]
                }
            ]
        },
        {
            "id": "clue2",
            "name": "Clue #2 - Binary Code",
            "description": "Convert binary to decimal",
            "onEnter": {
                "actions": [
                    {
                        "type": "showClippy",
                        "message": "Clue #2 involves binary! 101010 needs to be converted to a regular number.",
                        "duration": 5000
                    }
                ]
            },
            "hints": [
                { "delay": 45000, "message": "Binary 101010: Start from the right. Each digit is a power of 2." },
                { "delay": 90000, "message": "101010 = 32+8+2 = 42. The answer to everything!" }
            ],
            "triggers": [
                {
                    "id": "clue2-calc",
                    "event": "calculator:result",
                    "conditions": {
                        "type": "eventMatch",
                        "field": "value",
                        "value": 42
                    },
                    "actions": [
                        { "type": "setState", "path": "clue2Decoded", "value": true },
                        { "type": "modifyState", "path": "cluesFound", "operation": "increment" },
                        {
                            "type": "showNotification",
                            "message": "Clue #2 decoded! The second number is 42!",
                            "duration": 4000
                        },
                        { "type": "playSound", "sound": "click" },
                        { "type": "advanceStage", "stageId": "clue3" }
                    ]
                },
                {
                    "id": "clue2-typed",
                    "event": "notepad:typed",
                    "conditions": {
                        "type": "eventMatch",
                        "field": "content",
                        "op": "contains",
                        "value": "42"
                    },
                    "actions": [
                        { "type": "setState", "path": "clue2Decoded", "value": true },
                        { "type": "modifyState", "path": "cluesFound", "operation": "increment" },
                        {
                            "type": "showNotification",
                            "message": "Clue #2 decoded! The second number is 42!",
                            "duration": 4000
                        },
                        { "type": "playSound", "sound": "click" },
                        { "type": "advanceStage", "stageId": "clue3" }
                    ]
                }
            ]
        },
        {
            "id": "clue3",
            "name": "Clue #3 - Math Puzzle",
            "description": "Solve the equation",
            "onEnter": {
                "actions": [
                    {
                        "type": "showClippy",
                        "message": "Last clue! Use the Calculator to solve: (7x8) - (5x3) + 2",
                        "duration": 5000
                    }
                ]
            },
            "hints": [
                { "delay": 45000, "message": "Open Calculator from Start > Programs > Accessories" },
                { "delay": 90000, "message": "7x8=56, 5x3=15, so 56-15+2=43" }
            ],
            "triggers": [
                {
                    "id": "clue3-solved",
                    "event": "calculator:result",
                    "conditions": {
                        "type": "eventMatch",
                        "field": "value",
                        "value": 43
                    },
                    "actions": [
                        { "type": "setState", "path": "clue3Decoded", "value": true },
                        { "type": "modifyState", "path": "cluesFound", "operation": "increment" },
                        {
                            "type": "showNotification",
                            "message": "Clue #3 decoded! The third number is 43!",
                            "duration": 4000
                        },
                        { "type": "playSound", "sound": "click" },
                        { "type": "advanceStage", "stageId": "final" }
                    ]
                }
            ]
        },
        {
            "id": "final",
            "name": "The Final Code",
            "description": "Calculate the secret code",
            "onEnter": {
                "actions": [
                    {
                        "type": "showDialog",
                        "title": "All Clues Found!",
                        "message": "Excellent work, Agent!\n\nYou have decoded all three clues:\n‚Ä¢ Clue 1: 3\n‚Ä¢ Clue 2: 42\n‚Ä¢ Clue 3: 43\n\nNow calculate the sum of these numbers to reveal the secret code!",
                        "buttons": ["Calculate!"]
                    }
                ]
            },
            "hints": [
                { "delay": 30000, "message": "Add the three numbers: 3 + 42 + 43 = ?" }
            ],
            "triggers": [
                {
                    "id": "final-code",
                    "event": "calculator:result",
                    "conditions": {
                        "type": "eventMatch",
                        "field": "value",
                        "value": 88
                    },
                    "actions": [
                        { "type": "setState", "path": "secretRevealed", "value": true },
                        { "type": "completeScenario" }
                    ]
                }
            ]
        }
    ],

    "globalTriggers": [],

    "onComplete": {
        "actions": [
            {
                "type": "showDialog",
                "title": "SECRET CODE: 88",
                "message": "CONGRATULATIONS, AGENT!\n\nYou have successfully decoded all clues and discovered the secret code: 88\n\nThe number 88 symbolizes good fortune in many cultures.\n\nMission Complete.\n\n- X",
                "icon": "success",
                "buttons": ["Mission Complete"]
            },
            {
                "type": "unlockAchievement",
                "id": "cipher_master"
            },
            {
                "type": "playSound",
                "sound": "tada"
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "MYSTERY.txt"]
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "clue_1.txt"]
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "clue_2.txt"]
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "clue_3.txt"]
            },
            {
                "type": "createFile",
                "path": ["Desktop", "MISSION_COMPLETE.txt"],
                "content": "=== MISSION COMPLETE ===\n\nAgent,\n\nYou have proven yourself worthy.\n\nThe cipher hunt is complete.\nThe secret code was: 88\n\nUntil next time...\n\n- X",
                "addToDesktop": true,
                "icon": "üèÜ"
            }
        ]
    },

    "onFail": {
        "actions": [
            {
                "type": "showDialog",
                "title": "Mission Failed",
                "message": "The investigation was abandoned. The mystery remains unsolved...\n\nYou can try again anytime.",
                "icon": "warning"
            }
        ]
    },

    "onAbort": {
        "actions": [
            {
                "type": "showNotification",
                "message": "Mission aborted. Files have been cleaned up.",
                "duration": 3000
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "MYSTERY.txt"]
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "clue_1.txt"]
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "clue_2.txt"]
            },
            {
                "type": "deleteFile",
                "path": ["Desktop", "clue_3.txt"]
            }
        ]
    }
}
